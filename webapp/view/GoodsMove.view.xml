<mvc:View xmlns:mvc="sap.ui.core.mvc" xmlns="sap.m" xmlns:l="sap.ui.layout" xmlns:core="sap.ui.core"
          xmlns:f="sap.ui.layout.form"
          controllerName="glw.controller.GoodsMove"
          displayBlock="true">
    <Page title="{i18n>appTitle}" showNavButton="true" navButtonPress=".onNavBack"
          class="sapUiResponsiveContentPadding">
        <l:DynamicSideContent
                id="DynamicSideContent"
                class="sapUiDSCExplored sapUiContentPadding"
                containerQuery="true"
                sideContentVisibility="AlwaysShow"
                sideContentFallDown="BelowS"
                breakpointChanged="handleBreakpointChangeEvent"
                showSideContent="true">
            <l:mainContent>
                <f:SimpleForm editable="true"
                              layout="ResponsiveGridLayout"
                              labelSpanXL="3"
                              labelSpanL="3"
                              labelSpanM="3"
                              labelSpanS="12"
                              adjustLabelSpan="false"
                              emptySpanXL="1"
                              emptySpanL="1"
                              emptySpanM="1"
                              emptySpanS="0"
                              columnsXL="1"
                              columnsL="1"
                              columnsM="1"
                              singleContainerFullSize="false"
                              ariaLabelledBy="formTitle">
                    <f:toolbar>
                        <Toolbar>
                            <Title id="formTitle" text="Schnaps Umlagern" level="H2" titleStyle="H2"/>
                        </Toolbar>
                    </f:toolbar>
                    <f:content>

                        <Label text="Entnahmebehälter"/>
                        <ComboBox
                                id="sourceContainerSelect"
                                forceSelection="false"
                                showSecondaryValues="true"
                                filterSecondaryValues="true"
                                items="{path: 'container>/rows', sorter: {path: 'value/barCode'}}"
                                selectedKey="{/candidate/sourceContainer/value}"
                                valueState="{/candidate/sourceContainer/valueState}"
                                valueStateText="{/candidate/sourceContainer/valueStateText}"
                                selectionChange=".onContainerSelect">
                            <items>
                                <core:ListItem text="{container>value/barCode}"
                                               additionalText="{parts: ['container>value/productCategory', 'productCategories>/rows'], formatter: '.formatter.formatProductCategory'}"
                                               key="{container>value/barCode}"/>
                            </items>
                            <layoutData>
                                <l:GridData span="XL6 L6 M6 S12"/>
                            </layoutData>
                        </ComboBox>
                        <Text
                                text="{parts: ['/candidate/sourceContainer/value', 'container>/rows', 'productCategories>/rows'], formatter: '.formatter.formatProductCategoryByContainerBarCode'}"
                                class="sapUiTinyMarginBegin"/>

                        <Label text="Zielbehälter"/>
                        <ComboBox
                                id="targetContainerSelect"
                                forceSelection="false"
                                showSecondaryValues="true"
                                filterSecondaryValues="true"
                                items="{path: 'container>/rows', sorter: {path: 'value/barCode'}}"
                                selectedKey="{/candidate/targetContainer/value}"
                                valueState="{/candidate/targetContainer/valueState}"
                                valueStateText="{/candidate/targetContainer/valueStateText}"
                                selectionChange=".onContainerSelect">
                            <items>
                                <core:ListItem text="{container>value/barCode}"
                                               additionalText="{parts: ['container>value/productCategory', 'productCategories>/rows'], formatter: '.formatter.formatProductCategory'}"
                                               key="{container>value/barCode}"/>
                            </items>
                            <layoutData>
                                <l:GridData span="XL6 L6 M6 S12"/>
                            </layoutData>
                        </ComboBox>
                        <Text
                                text="{parts: ['/candidate/targetContainer/value', 'container>/rows', 'productCategories>/rows'], formatter: '.formatter.formatProductCategoryByContainerBarCode'}"
                                class="sapUiTinyMarginBegin"/>

                        <Label text="Umfüllmenge"/>
                        <StepInput textAlign="End"
                                   min="0"
                                   max="{= ${/sourceStock/quantity} ? ${/sourceStock/quantity} : 0}"
                                   step="{viewModel>/quantityFieldProperties/stepInputStep}"
                                   largerStep="{viewModel>/quantityFieldProperties/stepInputLargerStep}"
                                   displayValuePrecision="{viewModel>/quantityFieldProperties/stepInputDisplayValuePrecision}"
                                   change=".onQuantityChange"
                                   enabled="{/moveAllowed}"
                                   value="{path: '/candidate/quantity/value', type: 'sap.ui.model.type.Float',formatOptions: {maxFractionDigits: 2, emptyString: 0}, constraints: {minimum: 0, maximum: {path: '/sourceStock/quantity'}}}"
                                   valueState="{/candidate/quantity/valueState}"
                                   valueStateText="{/candidate/quantity/valueStateText}">
                            <layoutData>
                                <l:GridData span="XL6 L6 M6 S12"/>
                            </layoutData>
                        </StepInput>
                        <Text text="{parts: ['/sourceStock/batch/productCategory', 'productCategories>/rows', 'validValues>/'], formatter: '.formatter.formatNumberUnitByProductCategoryId'}"
                              class="sapUiTinyMarginBegin"/>


                        <Label text=""/>
                        <Button text="Umlagern" type="Emphasized" press=".onGoodsMove"
                                enabled="{= !!${/moveAllowed} &amp;&amp; ${/candidate/quantity/value} &gt; 0}">
                            <layoutData>
                                <l:GridData span="XL6 L6 M6 S12"/>
                            </layoutData>
                        </Button>
                    </f:content>
                </f:SimpleForm>
            </l:mainContent>
            <l:sideContent>
                <VBox fitContainer="true" renderType="Bare">
                    <Toolbar>
                        <Title level="H2" titleStyle="H2" text="Bestand"/>
                        <layoutData>
                            <FlexItemData shrinkFactor="0" growFactor="0"/>
                        </layoutData>
                    </Toolbar>
                    <ScrollContainer
                            height="100%"
                            width="100%"
                            horizontal="false"
                            vertical="true"
                            focusable="false"
                            visible="{= !!${/candidate/sourceContainer/value}}">
                        <content>
                            <List>
                                <ObjectListItem
                                        number="{path: '/sourceStock/quantity', type: 'sap.ui.model.type.Float', formatOptions: {maxFractionDigits: 2}}"
                                        numberUnit="{parts: ['/sourceStock/batch/productCategory', 'productCategories>/rows', 'validValues>/'], formatter: '.formatter.formatNumberUnitByProductCategoryId'}"
                                        title="{= ${/sourceStock/batch/productCategoryName} !== undefined ? ${/sourceStock/batch/productCategoryName} : '- Kein Bestand -'}">
                                    <attributes>
                                        <ObjectAttribute title="Behälter"
                                                         text="{parts: ['/sourceContainer/barCode', 'container>/rows', 'productCategories>/rows'], formatter: '.formatter.formatProductCategoryByContainerBarCode'} ({/sourceContainer/barCode})"/>
                                        <ObjectAttribute title="Lagerplatz" text="{/sourceContainer/storageBin}"/>
                                        <ObjectAttribute
                                                visible="{= !!${/sourceStock}}"
                                                title="Charge"
                                                text="{path: '/sourceStock/batch/batchDate', type: 'sap.ui.model.type.Date'}"/>
                                        <ObjectAttribute
                                                visible="{= !!${/sourceStock}}"
                                                title="Alkoholgehalt"
                                                text="{/sourceStock/batch/vol}"/>
                                    </attributes>
                                </ObjectListItem>
                                <ObjectListItem
                                        visible="{= !!${/sourceStock} &amp;&amp; ${/movedQuantity} !== null}"
                                        highlight="Warning"
                                        number="{path: '/movedQuantity', type: 'sap.ui.model.type.Float', formatOptions: {maxFractionDigits: 2}}"
                                        numberUnit="{parts: ['/sourceStock/batch/productCategory', 'productCategories>/rows', 'validValues>/'], formatter: '.formatter.formatNumberUnitByProductCategoryId'}"
                                        title="Umgelagert"/>
                                <ObjectListItem
                                        visible="{= !!${/sourceStock} &amp;&amp; ${/newQuantitySource} !== null}"
                                        highlight="Success"
                                        number="{path: '/newQuantitySource', type: 'sap.ui.model.type.Float', formatOptions: {maxFractionDigits: 2}}"
                                        numberUnit="{parts: ['/sourceStock/batch/productCategory', 'productCategories>/rows', 'validValues>/'], formatter: '.formatter.formatNumberUnitByProductCategoryId'}"
                                        title="Bestand Entnahmebehälter"/>
                                <ObjectListItem
                                        visible="{= !!${/targetStock} &amp;&amp; ${/newQuantityTarget} !== null}"
                                        highlight="Success"
                                        number="{path: '/newQuantityTarget', type: 'sap.ui.model.type.Float', formatOptions: {maxFractionDigits: 2}}"
                                        numberUnit="{parts: ['/targetStock/batch/productCategory', 'productCategories>/rows', 'validValues>/'], formatter: '.formatter.formatNumberUnitByProductCategoryId'}"
                                        title="Bestand Zielbehälter"/>
                            </List>
                        </content>
                        <layoutData>
                            <FlexItemData growFactor="1" baseSize="0%" shrinkFactor="1"/>
                        </layoutData>
                    </ScrollContainer>
                    <Text text="Bitte einen Behälter scannen oder eingeben."
                          visible="{= !${/candidate/sourceContainer/value}}" class="sapUiMediumMargin"/>
                </VBox>

            </l:sideContent>
        </l:DynamicSideContent>
    </Page>
</mvc:View>

