<mvc:View xmlns:mvc="sap.ui.core.mvc" xmlns="sap.m"
          controllerName="glw.controller.StockList"
          displayBlock="true">
    <Page title="{i18n>appTitle}" showNavButton="true" navButtonPress=".onNavBack">
        <IconTabBar
                id="idIconTabBar"
                expandable="false"
                applyContentPadding="false"
                stretchContentHeight="true"
                select="onIconTabBarSelect">
            <items>
                <IconTabFilter
                        key="overview"
                        icon="sap-icon://sys-find"
                        count="{stock>/totalCount}"
                        text="Übersicht">
                    <Page showHeader="false" class="sapUiResponsiveContentPadding">
                        <Table
                                id="stockListTable"
                                itemPress="onItemPress"
                                noDataText="Kein Bestand"
                                items="{path: 'stock>/aggregatedStock', sorter: {path: 'batch'}, events:{change:'.onStockListBindingChange'}}">
                            <headerToolbar>
                                <Toolbar>
                                    <Title text="Bestand" level="H2" width="9rem"/>
                                    <ToolbarSpacer/>
                                    <SearchField liveChange=".onSearchStockList" search=".onSearchStockList"/>
                                </Toolbar>
                            </headerToolbar>
                            <columns>
                                <Column
                                        width="12em">
                                    <Text text="Produkt"/>
                                </Column>
                                <Column
                                        width="12em">
                                    <Text text="Charge"/>
                                </Column>
                                <Column
                                        hAlign="End">
                                    <Text text="Füllmenge"/>
                                </Column>
                            </columns>
                            <items>
                                <ColumnListItem type="Navigation"
                                                highlight="{parts: ['stock>quantity', 'stock>batchQuantity'], formatter: '.formatter.formatStockListCriticalQuantity'}">
                                    <cells>
                                        <Text text="{parts: ['stock>productCategory', 'productCategories>/rows'], formatter: '.formatter.formatProductCategory'}"/>
                                        <Text text="{path: 'stock>batchDate', type: 'sap.ui.model.type.Date'}"/>
                                        <ObjectNumber
                                                number="{path: 'stock>quantity', type: 'sap.ui.model.type.Float', formatOptions: {maxFractionDigits: 2}}"
                                                unit="{stock>numberUnit}"/>
                                    </cells>
                                </ColumnListItem>

                            </items>
                        </Table>
                    </Page>
                </IconTabFilter>

                <IconTabFilter
                        key="details"
                        icon="sap-icon://begin"
                        iconColor="Positive"
                        count="{stock>/total_rows}"
                        text="Details">
                    <Page showHeader="false" class="sapUiResponsiveContentPadding">
                        <subHeader>
                            <OverflowToolbar>
                                <FacetFilter
                                        id="idFacetFilter"
                                        type="Simple"
                                        showPopoverOKButton="true"
                                        showPersonalization="true"
                                        showReset="true"
                                        reset="onResetFacetFilter"
                                        confirm="onConfirmFacetFilter">
                                    <lists>
                                        <FacetFilterList
                                                title="Produkt"
                                                key="batch/productCategory"
                                                mode="MultiSelect"
                                                items="{path:'productCategories>/rows', filters: {path: 'value/productGroup', operator: 'StartsWith', value1: 'FERT'}, templateShareable: 'false'}">
                                            <items>
                                                <FacetFilterItem
                                                        text="{productCategories>value/name}"
                                                        key="{productCategories>value/_id}"/>
                                            </items>
                                        </FacetFilterList>

                                        <FacetFilterList
                                                title="Jahrgang"
                                                key="year"
                                                mode="MultiSelect"
                                                items="{path:'stock>/years', templateShareable: 'false'}">
                                            <items>
                                                <FacetFilterItem
                                                        text="{stock>year}"
                                                        key="{path: 'stock>year', type: 'sap.ui.model.type.String'}"/>
                                            </items>
                                        </FacetFilterList>

                                        <FacetFilterList
                                                title="Behälter"
                                                key="container"
                                                mode="MultiSelect"
                                                items="{path:'container>/rows', templateShareable: 'false'}">
                                            <items>
                                                <FacetFilterItem
                                                        text="{parts: ['container>value/barCode', 'container>/rows', 'productCategories>/rows'], formatter: '.formatter.formatProductCategoryByContainerBarCode'} ({container>value/barCode})"
                                                        key="{container>value/barCode}"/>
                                            </items>
                                        </FacetFilterList>

                                        <FacetFilterList
                                                title="Lagerplatz"
                                                key="storageBin"
                                                mode="MultiSelect"
                                                items="{path:'storageBins>/rows', templateShareable: 'false'}">
                                            <items>
                                                <FacetFilterItem
                                                        text="{storageBins>value/id}"
                                                        key="{storageBins>value/id}"/>
                                            </items>
                                        </FacetFilterList>

                                    </lists>
                                </FacetFilter>
                            </OverflowToolbar>
                        </subHeader>
                        <content>
                            <Table
                                    id="stockListDetailsTable"
                                    noDataText="Kein Bestand"
                                    items="{path: 'stock>/list', sorter: {path: 'quantity'}, events:{change:'.onStockListDetailsBindingChange'}}">
                                <headerToolbar>
                                    <Toolbar>
                                        <Title text="Bestand" level="H2" width="15rem"/>
                                        <ToolbarSpacer/>
                                        <SearchField liveChange=".onSearchStockListDetails"
                                                     search=".onSearchStockListDetails"/>
                                    </Toolbar>
                                </headerToolbar>
                                <columns>
                                    <Column
                                            width="12em">
                                        <Text text="Produkt"/>
                                    </Column>
                                    <Column
                                            width="12em">
                                        <Text text="Charge"/>
                                    </Column>
                                    <Column
                                            width="12em">
                                        <Text text="Lagerplatz"/>
                                    </Column>
                                    <Column
                                            width="12em">
                                        <Text text="Behälter"/>
                                    </Column>
                                    <Column
                                            hAlign="Right"
                                            width="12em">
                                        <Text text="Behältervolumen"/>
                                    </Column>
                                    <Column
                                            hAlign="Right">
                                        <Text text="Füllmenge"/>
                                    </Column>
                                </columns>
                                <items>
                                    <ColumnListItem>
                                        <cells>
                                            <ObjectIdentifier
                                                    title="{stock>productCategoryName}"
                                                    text="{stock>year}"/>
                                            <Text text="{path: 'stock>batch/batchDate', type: 'sap.ui.model.type.Date'}"/>
                                            <Text text="{stock>storageBin}"/>
                                            <ObjectIdentifier
                                                    title="{stock>containerName}"
                                                    text="{stock>container}"/>
                                            <ObjectNumber
                                                    visible="{= !!${stock>containerVolume}}"
                                                    number="{path: 'stock>containerVolume', type: 'sap.ui.model.type.Float', formatOptions: {maxFractionDigits: 2}}"
                                                    unit="Liter"/>
                                            <ObjectNumber
                                                    number="{path: 'stock>quantity', type: 'sap.ui.model.type.Float', formatOptions: {maxFractionDigits: 2}}"
                                                    unit="{stock>numberUnit}"/>
                                        </cells>
                                    </ColumnListItem>
                                </items>
                            </Table>
                        </content>
                    </Page>

                </IconTabFilter>

            </items>
        </IconTabBar>
        <footer>
            <Toolbar>
                <ToolbarSpacer/>
                <Text text="Summe: {path: 'viewModel>/filteredQuantity', type: 'sap.ui.model.type.Float', formatOptions: {maxFractionDigits: 2}}l"
                      class="sapUiSmallMarginEnd"/>
            </Toolbar>
        </footer>
    </Page>
</mvc:View>
